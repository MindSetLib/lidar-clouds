# lidar-clouds

## –°—Ö–µ–º–∞
```mermaid
flowchart TD
    %% ==== –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ====
    A["–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PCD –∏–ª–∏ LAS"] --> B["–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ S3 / MinIO –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫"]

    %% ==== ML –æ–±—Ä–∞–±–æ—Ç–∫–∞ ====
    B --> C["–û—Ç–ø—Ä–∞–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ ML —Å–µ—Ä–≤–∏—Å"]
    C --> D["ML —Å–µ—Ä–≤–∏—Å: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ LAS / PCD"]
    
    %% ==== –ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ====
    D --> E["–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ LAZ —á–µ—Ä–µ–∑ PDAL"]
    E --> F["–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ Octree –¥–ª—è Potree (PotreeConverter)"]
    
    %% ==== Backend API ====
    F --> G["Backend API (FastAPI / Node.js)"]
    G --> G1["–†–∞–∑–¥–∞—á–∞ bin —Ç–∞–π–ª–æ–≤ –∏ hierarchy.json —á–µ—Ä–µ–∑ HTTP"]
    G --> G2["GET /region?bbox=... –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç mini-bin —á–∞–Ω–∫–∏"]
    G --> G3["POST /patch –ø—Ä–∏–Ω–∏–º–∞–µ—Ç add / remove —Ç–æ—á–µ–∫ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥–æ–≤"]
    
    %% ==== Frontend ====
    G1 --> H["Frontend: Potree / WebGL"]
    G2 --> H
    H --> H1["–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Octree –∏ LOD"]
    H1 --> H2["–í—ã–±–æ—Ä –æ–±–ª–∞—Å—Ç–∏ bbox / –ø–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥–∞"]
    H2 --> H3["–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ"]
    H3 --> H4["–î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ—á–µ–∫"]
    H4 --> G3
    
    %% ==== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ====
    G3 --> I["–ë—ç–∫–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞—Ç—á–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (mini-bin patch)"]
    I --> J["–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π merge mini-bin —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –ª–∏—Å—Ç–∞–º–∏"]
    J --> K["–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö bin –≤ mini-LAS —á–µ—Ä–µ–∑ PDAL"]
    K --> L["–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö mini-LAS –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π LAS (PDAL merge)"]
    L --> M["–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Octree –Ω–æ–≤—ã–º PotreeConverter"]
    M --> N["–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö bin —Ñ–∞–π–ª–æ–≤ –∏ hierarchy.json"]
    N --> H["–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏"]
    
    %% ==== –≠–∫—Å–ø–æ—Ä—Ç ====
    L --> O["–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π LAS / PCD –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"]
    O --> P["–ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ"]

```

–ù–∏–∂–µ ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π **–ø–æ—à–∞–≥–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–∏–≥–∞–±–∞–π—Ç–Ω—ã–º–∏ PCD-—Ñ–∞–π–ª–∞–º–∏ –≤ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–µ, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
–û–Ω –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å–≤—è–∑–∫–µ **PDAL ‚Üí Potree (–∏–ª–∏ Open3D WebVisualizer)** –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä, —Ç–∞–∫ –∏ –≤—ã–±–æ—Ä–æ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏.

---

## üü¢ –®–∞–≥ 1. –ü—Ä–∏—ë–º –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

1. **–ó–∞–≥—Ä—É–∑–∫–∞**
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –±–æ–ª—å—à–æ–π `.pcd` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ API/–≤–µ–±).
2. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
   –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫ –≤ —Ñ–∞–π–ª–æ–≤–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä S3/MinIO –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫).
   ‚ûú **–í–∞–∂–Ω–æ**: –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è —Å—Ä–∞–∑—É –æ—Ç–¥–∞–≤–∞—Ç—å PCD –∫–ª–∏–µ–Ω—Ç—É.

---

## üü† –®–∞–≥ 2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏ –Ω–∞—Ä–µ–∑–∫–∞

–¶–µ–ª—å ‚Äî —Å–¥–µ–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≥–æ–¥–Ω—ã–º–∏ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ –∏ LOD.

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PCD ‚Üí LAZ** (–∏–ª–∏ LAS)

   ```bash
   pdal translate input.pcd output.laz
   ```

   * LAZ —Å–∂–∏–º–∞–µ—Ç —Ç–æ—á–∫–∏ –≤ \~5‚Äì10 —Ä–∞–∑ –±–µ–∑ –ø–æ—Ç–µ—Ä—å.
2. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ Octree –¥–ª—è Potree**
   –ò—Å–ø–æ–ª—å–∑—É–µ–º `PotreeConverter`:

   ```bash
   PotreeConverter output.laz -o ./potree_data --generate-page mypointcloud
   ```

   * —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–π–ª—ã –∏ —É—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (LOD).
   * –ø–æ–ª—É—á–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ `octree.bin + hierarchy.json`.
3. **(–û–ø—Ü–∏—è) PDAL –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —á–∞–Ω–∫–æ–≤**
   –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á–∞–Ω–∫–æ–≤ ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Ä–µ–∑–∞—Ç—å –Ω–∞ bounding box'—ã:

   ```bash
   pdal split input.laz --capacity 5e6
   ```

   –ö–∞–∂–¥–æ–º—É —á–∞–Ω–∫—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è bbox.

---

## üü° –®–∞–≥ 3. Backend API

–ë–µ–∫–µ–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä **FastAPI** –∏–ª–∏ **Node.js**) –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

* –†–∞–∑–¥–∞—á—É Potree-—Ç–∞–π–ª–æ–≤ –ø–æ HTTP (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏).
* API `GET /region?bbox=...` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–ø–æ–ª–Ω–æ–µ –æ–±–ª–∞–∫–æ** –∏–ª–∏ PCD-—á–∞–Ω–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
* API `POST /patch` ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ/—É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–∏).

---

## üü¢ –®–∞–≥ 4. Frontend (Web-–∫–ª–∏–µ–Ω—Ç)

**–û—Å–Ω–æ–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**

* Potree (–∏–ª–∏ Open3D WebVisualizer) –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç octree/LOD.
* –¢–∞–π–ª—ã –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏/–∑—É–º–∞—Ö.

**–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–≥–∏–æ–Ω (bbox/–ø–∞—Ä–∞–ª–ª–µ–ø–∏–ø–µ–¥).
2. –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –±–µ–∫–µ–Ω–¥–∞ `GET /region` –∏ –ø–æ–ª—É—á–∞–µ—Ç **–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–æ—á–µ–∫** —Ç–æ–ª—å–∫–æ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏ (–≤ PCD –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ).
3. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä (Three.js/Open3D) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

   * –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
   * –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ/—Å–∂–∞—Ç–∏–µ –æ–±–ª–∞—Å—Ç–∏
   * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫
   * –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ/–≤—Å—Ç–∞–≤–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π
4. –ü–æ—Å–ª–µ –ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–ø–∞—Ç—á**:

   ```json
   {
     "region_id": "tile_42",
     "add_points": [...],
     "remove_points_ids": [...]
   }
   ```

---

## üü£ –®–∞–≥ 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

1. –°–æ—Ö—Ä–∞–Ω—è–µ–º ¬´—Å–ª–æ–π –ø—Ä–∞–≤–æ–∫¬ª –æ—Ç–¥–µ–ª—å–Ω–æ (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≥–∏–≥–∞–±–∞–π—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).
2. –ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ **—Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã**:

   * –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –æ–±–ª–∞–∫–æ —Å –ø–∞—Ç—á–∞–º–∏ (—á–µ—Ä–µ–∑ PDAL `merge`),
   * –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ `.pcd`:

     ```bash
     pdal translate merged.laz final_output.pcd
     ```

---

## ‚ö° –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

| –≠—Ç–∞–ø              | –ß—Ç–æ –¥–∞—ë—Ç                                               |
| ----------------- | ------------------------------------------------------ |
| Potree Octree     | –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–∞–∂–µ –¥–ª—è >100 –ì–ë                |
| –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ | —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π                  |
| –°–ª–æ–π –ø—Ä–∞–≤–æ–∫       | –±—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –≥–∏–≥–∞–±–∞–π—Ç–æ–≤ |
| PDAL              | –≥–∏–±–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PCD ‚áÑ LAZ, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –∫—Ä–æ–ø—ã        |

---

### üîë –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫

* **Backend**: Python FastAPI + PDAL + PotreeConverter.
* **Frontend**: Potree Viewer (WebGL/Three.js) + –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
* **Storage**: S3/MinIO –¥–ª—è —Ç–∞–π–ª–æ–≤, PostgreSQL (–æ–ø—Ü–∏—è) –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

---

–≠—Ç–æ—Ç –ø–∞–π–ø–ª–∞–π–Ω —Ö–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è:

* –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–µ—Å—è—Ç–∫–∏ –≥–∏–≥–∞–±–∞–π—Ç –¥–∞–Ω–Ω—ã—Ö,
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –±—ã—Å—Ç—Ä—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é,
* –∏ –ø—Ä–∏ —ç—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ **PCD**.
